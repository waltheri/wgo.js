/*! MIT license, more info: wgo.waltheri.net */ (function(e,t){"use strict";var n=function(e){var t=new l(JSON.parse(JSON.stringify(e.getProperties())));for(var r in e.children){t.appendChild(n(e.children[r]))}return t};var r=function(e,n){var i;if(n[e]!==t)return n[e];for(var s in n.children){i=r(e,n.children[s]);if(i)return i}return false};var i=function(e,t){e.push(JSON.parse(JSON.stringify(t.getProperties())));if(t.children.length>1){var n=[];for(var r=0;r<t.children.length;r++){var s=[];i(s,t.children[r]);n.push(s)}e.push(n)}else if(t.children.length){i(e,t.children[0])}};var s=function(e,t){var n=t;var r;for(var i=1;i<e.length;i++){if(e[i].constructor==Array){for(var o=0;o<e[i].length;o++){r=new l(e[i][o][0]);n.appendChild(r);s(e[i][o],r)}}else{r=new l(e[i]);n.insertAfter(r);n=r}}};var o=function(){this.size=19;this.info={};this.root=new l;this.nodeCount=0;this.propertyCount=0};o.prototype={constructor:o,clone:function(){var e=new o;e.size=this.size;e.info=JSON.parse(JSON.stringify(this.info));e.root=n(this.root);e.nodeCount=this.nodeCount;e.propertyCount=this.propertyCount;return e},hasComments:function(){return!!r("comment",this.root)}};o.fromSgf=function(t){return e.SGF.parse(t)};o.fromJGO=function(e){var t=typeof e=="string"?JSON.parse(e):e;var n=new o;n.info=JSON.parse(JSON.stringify(t.info));n.size=t.size;n.nodeCount=t.nodeCount;n.propertyCount=t.propertyCount;n.root=new l(t.game[0]);s(t.game,n.root);return n};o.prototype.toSgf=function(){};o.prototype.toJGO=function(e){var t={};t.size=this.size;t.info=JSON.parse(JSON.stringify(this.info));t.nodeCount=this.nodeCount;t.propertyCount=this.propertyCount;t.game=[];i(t.game,this.root);if(e)return JSON.stringify(t);else return t};var u=function(t){var n;if(t.name){n=e.filterHTML(t.name);if(t.rank)n+=" ("+e.filterHTML(t.rank)+")";if(t.team)n+=", "+e.filterHTML(t.team)}else{if(t.team)n=e.filterHTML(t.team);if(t.rank)n+=" ("+e.filterHTML(t.rank)+")"}return n};o.infoFormatters={black:u,white:u,TM:function(t){if(t==0)return e.t("none");var n,r=Math.floor(t/60);if(r==1)n="1 "+e.t("minute");else if(r>1)n=r+" "+e.t("minutes");r=t%60;if(r==1)n+=" 1 "+e.t("second");else if(r>1)n+=" "+r+" "+e.t("seconds");return n},RE:function(t){return'<a href="javascript: void(0)" onclick="this.parentNode.innerHTML = \''+e.filterHTML(t)+'\'" title="'+e.t("res-show-tip")+'">'+e.t("show")+"</a>"}};o.infoList=["black","white","AN","CP","DT","EV","GN","GC","ON","OT","RE","RO","RU","SO","TM","PC","KM"];e.Kifu=o;var a=function(e,t,n){for(var r=0;r<e.length;r++){if(e[r].x==t.x&&e[r].y==t.y){e[r][n]=t[n];return}}e.push(t)};var f=function(e,t){if(!e)remove;for(var n=0;n<e.length;n++){if(e[n].x==t.x&&e[n].y==t.y){e.splice(n,1);return}}};var l=function(e,t){this.parent=t||null;this.children=[];if(e)for(var n in e)this[n]=e[n]};l.prototype={constructor:l,getChild:function(e){var t=e||0;if(this.children[t])return this.children[t];else return null},addSetup:function(e){this.setup=this.setup||[];a(this.setup,e,"c");return this},removeSetup:function(e){f(this.setup,e);return this},addMarkup:function(e){this.markup=this.markup||[];a(this.markup,e,"type");return this},removeMarkup:function(e){f(this.markup,e);return this},remove:function(){var e=this.parent;if(!e)throw new Exception("Root node cannot be removed");for(var t in e.children){if(e.children[t]==this){e.children.splice(t,1);break}}e.children=e.children.concat(this.children);this.parent=null;return e},insertAfter:function(e){e.children=e.children.concat(this.children);e.parent=this;this.children=[e];return e},appendChild:function(e){e.parent=this;this.children.push(e);return e},getProperties:function(){var e={};for(var t in this){if(this.hasOwnProperty(t)&&t!="children"&&t!="parent")e[t]=this[t]}return e}};e.KNode=l;var c=function(e,t){var n=e.size,r=[],i=[];for(var s=0;s<n*n;s++){if(e.schema[s]&&!t.schema[s])i.push({x:Math.floor(s/n),y:s%n});else if(e.schema[s]!=t.schema[s])r.push({x:Math.floor(s/n),y:s%n,c:t.schema[s]})}return{add:r,remove:i}};var h=function(t,n){this.kifu=t;this.node=this.kifu.root;this.game=new e.Game(this.kifu.size);this.path={m:0};this.change=v(this.game,this.node,true);if(this.kifu.info["HA"]&&this.kifu.info["HA"]>1)this.game.turn=e.W;if(n)this.rememberPath=true;else this.rememberPath=false};var p=function(e,t){var n=[],r;for(var i in e){r=true;for(var s in t){if(e[i].x==t[s].x&&e[i].y==t[s].y){r=false;break}}if(r)n.push(e[i])}return n};var d=function(e,t){e.add=p(e.add,t.remove).concat(t.add);e.remove=p(e.remove,t.add).concat(t.remove)};var v=function(e,n,r){if(n.parent)n.parent._last_selected=n.parent.children.indexOf(n);if(n.move!=t){if(n.move.pass){e.pass(n.move.c);return{add:[],remove:[]}}else{var i=e.play(n.move.x,n.move.y,n.move.c);if(typeof i=="number")throw new b(i,n);return{add:[n.move],remove:i}}}else if(n.setup!=t){if(!r)e.pushPosition();var s=[],o=[];for(var u in n.setup){if(n.setup[u].c){e.addStone(n.setup[u].x,n.setup[u].y,n.setup[u].c);s.push(n.setup[u])}else{e.removeStone(n.setup[u].x,n.setup[u].y);o.push(n.setup[u])}}if(n.turn)e.turn=n.turn;return{add:s,remove:o}}else if(!r){e.pushPosition()}return{add:[],remove:[]}};var m=function(e){if(e===t&&this.rememberPath)e=this.node._last_selected;e=e||0;var n=this.node.children[e];if(!n)return false;var r=v(this.game,n);this.path.m++;if(this.node.children.length>1)this.path[this.path.m]=e;this.node=n;return r};var g=function(){if(!this.node.parent)return false;this.node=this.node.parent;this.game.popPosition();this.path.m--;if(this.path[this.path.m]!==t)delete this.path[this.path.m];return true};var y=function(){this.game.firstPosition();this.node=this.kifu.root;this.path={m:0};this.change=v(this.game,this.node,true);if(this.kifu.info["HA"]&&this.kifu.info["HA"]>1)this.game.turn=e.W};h.prototype={constructor:h,next:function(e){this.change=m.call(this,e);return this},last:function(){var e;this.change={add:[],remove:[]};while(e=m.call(this))d(this.change,e);return this},previous:function(){var e=this.game.getPosition();g.call(this);this.change=c(e,this.game.getPosition());return this},first:function(){var e=this.game.getPosition();y.call(this);this.change=c(e,this.game.getPosition());return this},goTo:function(e){if(e===t)return this;var n=this.game.getPosition();y.call(this);var r;for(var i=0;i<e.m;i++){if(!m.call(this,e[i+1])){break}}this.change=c(n,this.game.getPosition());return this},previousFork:function(){var e=this.game.getPosition();while(g.call(this)&&this.node.children.length==1);this.change=c(e,this.game.getPosition());return this},getPosition:function(){return this.game.getPosition()}};e.KifuReader=h;var b=function(n,r){this.name="InvalidMoveError";this.message="Invalid move in kifu detected. ";if(r.move&&r.move.c!==t&&r.move.x!==t&&r.move.y!==t)this.message+="Trying to play "+(r.move.c==e.WHITE?"white":"black")+" move on "+String.fromCharCode(r.move.x+65)+""+(19-r.move.y);else this.message+="Move object doesn't contain arbitrary attributes.";if(n){switch(n){case 1:this.message+=", but these coordinates are not on board.";break;case 2:this.message+=", but there already is a stone.";break;case 3:this.message+=", but this move is a suicide.";case 4:this.message+=", but this position already occured.";break}}else this.message+="."};b.prototype=new Error;b.prototype.constructor=b;e.InvalidMoveError=b;e.i18n.en["show"]="show";e.i18n.en["res-show-tip"]="Click to show result."})(WGo);(function(e,t){e.SGF={};var n=function(e,t){return e.charCodeAt(t)-97};var r=function(e,t,n,r,i,s){var o=s==t?"black":"white";n.info[o]=n.info[o]||{};n.info[o][e]=i[0]};var i=e.SGF.properties={};i["B"]=i["W"]=function(t,r,i,s){if(!i[0]||t.size<=19&&i[0]=="tt")r.move={pass:true,c:s=="B"?e.B:e.W};else r.move={x:n(i[0],0),y:n(i[0],1),c:s=="B"?e.B:e.W}};i["AB"]=i["AW"]=function(t,r,i,s){for(var o in i){r.addSetup({x:n(i[o],0),y:n(i[o],1),c:s=="AB"?e.B:e.W})}};i["AE"]=function(e,t,r){for(var i in r){t.addSetup({x:n(r[i],0),y:n(r[i],1)})}};i["PL"]=function(t,n,r){n.turn=r[0]=="b"?e.B:e.W};i["C"]=function(e,t,n){t.comment=n.join()};i["LB"]=function(e,t,r){for(var i in r){t.addMarkup({x:n(r[i],0),y:n(r[i],1),type:"LB",text:r[i].substr(3)})}};i["CR"]=i["SQ"]=i["TR"]=i["SL"]=i["MA"]=function(e,t,r,i){for(var s in r){t.addMarkup({x:n(r[s],0),y:n(r[s],1),type:i})}};i["SZ"]=function(e,t,n){e.size=parseInt(n[0])};i["BR"]=i["WR"]=r.bind(this,"rank","BR");i["PB"]=i["PW"]=r.bind(this,"name","PB");i["BT"]=i["WT"]=r.bind(this,"team","BT");i["TM"]=function(e,t,n,r){e.info[r]=n[0];t.BL=n[0];t.WL=n[0]};var s=/\(|\)|(;(\s*[A-Z]+\s*((\[\])|(\[(.|\s)*?([^\\]\])))+)*)/g;var o=/[A-Z]+\s*((\[\])|(\[(.|\s)*?([^\\]\])))+/g;var u=/[A-Z]+/;var a=/(\[\])|(\[(.|\s)*?([^\\]\]))/g;e.SGF.parse=function(t){var n=[],r,i,f,l,c=new e.Kifu,h=null;r=t.match(s);for(var p in r){if(r[p]=="(")n.push(h);else if(r[p]==")")h=n.pop();else{if(h)c.nodeCount++;h=h?h.appendChild(new e.KNode):c.root;i=r[p].match(o);c.propertyCount+=i.length;for(var d in i){l=u.exec(i[d])[0];f=i[d].match(a);for(var v in f)f[v]=f[v].substring(1,f[v].length-1).replace(/\\(?!\\)/g,"");if(e.SGF.properties[l])e.SGF.properties[l](c,h,f,l);else{if(f.length<=1)f=f[0];if(h.parent)h[l]=f;else{c.info[l]=f}}}}}return c}})(WGo);(function(e){"use strict";var t=function(e,t){this.name="FileError";if(t==1)this.message="File '"+e+"' is empty.";else if(t==2)this.message="Network error. It is not possible to read '"+e+"'.";else this.message="File '"+e+"' hasn't been found on server."};t.prototype=new Error;t.prototype.constructor=t;e.FileError=t;var n=e.loadFromUrl=function(e,n){var r=new XMLHttpRequest;r.onreadystatechange=function(){if(r.readyState==4){if(r.status==200){if(r.responseText.length==0){throw new t(e,1)}else{n(r.responseText)}}else{throw new t(e)}}};try{r.open("GET",e,true);r.send()}catch(i){throw new t(e,2)}};var r=function(t){if(!t.change)return;this.board.update(t.change);if(this.temp_marks)this.board.removeObject(this.temp_marks);var n=[];if(t.node.move){if(t.node.move.pass)this.setMessage({text:e.t((t.node.move.c==e.B?"b":"w")+"pass"),type:"notification"});else n.push({type:"CR",x:t.node.move.x,y:t.node.move.y})}if(t.node.children.length>1){for(var r=0;r<t.node.children.length;r++){if(t.node.children[r].move)n.push({type:"LB",text:String.fromCharCode(65+r),x:t.node.children[r].move.x,y:t.node.children[r].move.y})}}if(t.node.markup){for(var r in t.node.markup){for(var i=0;i<n.length;i++){if(t.node.markup[r].x==n[i].x&&t.node.markup[r].y==n[i].y){n.splice(i,1);i--}}}n=n.concat(t.node.markup)}this.temp_marks=n;this.board.addObject(n)};var i=function(e){this.board.setSize(e.kifu.size);this.board.removeAllObjects();if(this.config.enableWheel)this.setWheel(true)};var s=function(e,t){if(e==t.element||e==t.element)return false;else if(e._wgo_scrollable||e.scrollHeight>e.offsetHeight)return true;else return s(e.parentNode,t)};var o=function(e){var t=e.wheelDelta||e.detail*-1;if(s(e.target,this))return true;if(t<0){this.next();if(this.config.lockScroll&&e.preventDefault)e.preventDefault();return!this.config.lockScroll}else if(t>0){this.previous();if(this.config.lockScroll&&e.preventDefault)e.preventDefault();return!this.config.lockScroll}return true};var u=function(e){switch(e.keyCode){case 39:this.next();break;case 37:this.previous();break;default:return true}if(this.config.lockScroll&&e.preventDefault)e.preventDefault();return!this.config.lockScroll};var a=function(e,t){if(!this.kifuReader||!this.kifuReader.node)return false;for(var n in this.kifuReader.node.children){if(this.kifuReader.node.children[n].move&&this.kifuReader.node.children[n].move.x==e&&this.kifuReader.node.children[n].move.y==t){this.next(n);return}}};var f={grid:{draw:function(e,t){var n,r,i,s,o,u;this.fillStyle="rgba(0,0,0,0.7)";this.textBaseline="middle";this.textAlign="center";this.font=t.stoneRadius+"px "+(t.font||"");i=t.getX(-.75);s=t.getX(t.size-.25);o=t.getY(-.75);u=t.getY(t.size-.25);for(var a=0;a<t.size;a++){n=a+"A".charCodeAt(0);if(n>="I".charCodeAt(0))n++;r=t.getY(a);this.fillText(t.size-a,i,r);this.fillText(t.size-a,s,r);r=t.getX(a);this.fillText(String.fromCharCode(n),r,o);this.fillText(String.fromCharCode(n),r,u)}this.fillStyle="black"}}};var l=function(t){this.config=t;for(var n in PlayerView.default)if(this.config[n]===undefined&&PlayerView.default[n]!==undefined)this.config[n]=PlayerView.default[n];this.element=document.createElement("div");this.board=new e.Board(this.element,this.config.board);this.init();this.initGame()};l.prototype={constructor:l,init:function(){this.kifu=null;this.listeners={kifuLoaded:[i.bind(this)],update:[r.bind(this)],frozen:[],unfrozen:[]};if(this.config.kifuLoaded)this.addEventListener("kifuLoaded",this.config.kifuLoaded);if(this.config.update)this.addEventListener("update",this.config.update);if(this.config.frozen)this.addEventListener("frozen",this.config.frozen);if(this.config.unfrozen)this.addEventListener("unfrozen",this.config.unfrozen);this.board.addEventListener("click",a.bind(this));this.element.addEventListener("click",this.focus.bind(this));this.focus()},initGame:function(){if(this.config.sgf){this.loadSgf(this.config.sgf,this.config.move)}else if(this.config.json){this.loadJSON(this.config.json,this.config.move)}else if(this.config.sgfFile){this.loadSgfFromFile(this.config.sgfFile,this.config.move)}},update:function(e){if(!this.kifuReader||!this.kifuReader.change)return;var t={type:"update",op:e,target:this,node:this.kifuReader.node,position:this.kifuReader.getPosition(),path:this.kifuReader.path,change:this.kifuReader.change};this.dispatchEvent(t)},loadKifu:function(t,n){this.kifu=t;this.kifuReader=new e.KifuReader(this.kifu,this.config.rememberPath);this.dispatchEvent({type:"kifuLoaded",target:this,kifu:this.kifu});if(n){this.goTo(n)}else{this.update("init")}},loadSgf:function(t,n){try{this.loadKifu(e.Kifu.fromSgf(t),n)}catch(r){this.error(r)}},loadJSON:function(t){try{this.loadKifu(e.Kifu.fromJGO(t),path)}catch(n){this.error(n)}},loadSgfFromFile:function(e,t){var r=this;try{n(e,function(e){r.loadSgf(e,t)})}catch(i){this.error(i)}},addEventListener:function(e,t){this.listeners[e]=this.listeners[e]||[];this.listeners[e].push(t)},removeEventListener:function(e,t){if(!this.listeners[e])return;var n=this.listeners[e].indexOf(t);if(n!=-1)this.listeners[e].splice(n,1)},dispatchEvent:function(e){if(!this.listeners[e.type])return;for(var t in this.listeners[e.type])this.listeners[e.type][t](e)},notification:function(e){if(console)console.log(e)},help:function(e){if(console)console.log(e)},error:function(t){if(!e.ERROR_REPORT)throw t;if(console)console.log(t)},next:function(e){if(this.frozen||!this.kifu)return;try{this.kifuReader.next(e);this.update()}catch(t){this.error(t)}},previous:function(){if(this.frozen||!this.kifu)return;try{this.kifuReader.previous();this.update()}catch(e){this.error(e)}},last:function(){if(this.frozen||!this.kifu)return;try{this.kifuReader.last();this.update()}catch(e){this.error(e)}},first:function(){if(this.frozen||!this.kifu)return;try{this.kifuReader.first();this.update()}catch(e){this.error(e)}},goTo:function(t){if(this.frozen||!this.kifu)return;var n;if(typeof t=="function")t=t.call(this);if(typeof t=="number"){n=e.clone(this.kifuReader.path);n.m=t||0}else n=t;try{this.kifuReader.goTo(n);this.update()}catch(r){this.error(r)}},getGameInfo:function(){if(!this.kifu)return null;var t={};for(var n in this.kifu.info){if(e.Kifu.infoList.indexOf(n)==-1)continue;if(e.Kifu.infoFormatters[n]){t[e.t(n)]=e.Kifu.infoFormatters[n](this.kifu.info[n])}else t[e.t(n)]=e.filterHTML(this.kifu.info[n])}return t},setFrozen:function(e){this.frozen=e;this.dispatchEvent({type:this.frozen?"frozen":"unfrozen",target:this})},appendTo:function(e){e.appendChild(this.element)},focus:function(){if(this.config.enableKeys)this.setKeys(true)},setKeys:function(t){if(t){if(e.mozilla)document.onkeypress=u.bind(this);else document.onkeydown=u.bind(this)}else{if(e.mozilla)document.onkeypress=null;else document.onkeydown=null}},setWheel:function(t){if(!this._wheel_listener&&t){this._wheel_listener=o.bind(this);var n=e.mozilla?"DOMMouseScroll":"mousewheel";this.element.addEventListener(n,this._wheel_listener)}else if(this._wheel_listener&&!t){var n=e.mozilla?"DOMMouseScroll":"mousewheel";this.element.removeEventListener(n,this._wheel_listener);delete this._wheel_listener}},setCoordinates:function(e){if(!this.coordinates&&e){this.board.setSection(-.5,-.5,-.5,-.5);this.board.addCustomObject(f)}else if(this.coordinates&&!e){this.board.setSection(0,0,0,0);this.board.removeCustomObject(f)}this.coordinates=e}};l.default={sgf:undefined,json:undefined,sgfFile:undefined,move:undefined,board:{},enableWheel:true,lockScroll:true,enableKeys:true,rememberPath:true,kifuLoaded:undefined,update:undefined,frozen:undefined,unfrozen:undefined};e.Player=l;var c={"about-text":"<h1>WGo.js Player 2.0</h1>"+"<p>WGo.js Player is extension of WGo.js, HTML5 library for purposes of game of go. It allows to replay go game records and it has many features like score counting. It is also designed to be easily extendable.</p>"+"<p>WGo.js is open source licensed under <a href='http://en.wikipedia.org/wiki/MIT_License' target='_blank'>MIT license</a>. You can use and modify any code from this project.</p>"+"<p>You can find more information at <a href='http://wgo.waltheri.net/player' target='_blank'>wgo.waltheri.net/player</a></p>"+"<p>Copyright © 2013 Jan Prokop</p>",black:"Black",white:"White",DT:"Date",KM:"Komi",HA:"Handicap",AN:"Annotations",CP:"Copyright",OT:"Overtime",TM:"Basic time",RE:"Result",RU:"Rules",PC:"Place",EV:"Event",SO:"Source",none:"none",bpass:"Black passed.",wpass:"White passed."};for(var h in c)e.i18n.en[h]=c[h]})(WGo);(function(WGo){"use strict";var pl_count=0;var playerBlock=function(e,t,n){var r={};r.element=document.createElement("div");r.element.className="wgo-player-"+e;r.wrapper=document.createElement("div");r.wrapper.className="wgo-player-"+e+"-wrapper";r.element.appendChild(r.wrapper);t.appendChild(r.element);if(!n)r.element.style.display="none";return r};var BPgenerateDom=function(){this.dom={};this.dom.center=document.createElement("div");this.dom.center.className="wgo-player-center";this.dom.board=document.createElement("div");this.dom.board.className="wgo-player-board";this.regions={};this.regions.left=playerBlock("left",this.element);this.element.appendChild(this.dom.center);this.regions.right=playerBlock("right",this.element);this.regions.top=playerBlock("top",this.dom.center);this.dom.center.appendChild(this.dom.board);this.regions.bottom=playerBlock("bottom",this.dom.center)};var getCurrentLayout=function(){var e=this.config.layout;if(e.constructor!=Array)return e;var t=this.height||this.maxHeight;for(var n=0;n<e.length;n++){if(!e[n].conditions||(!e[n].conditions.minWidth||e[n].conditions.minWidth<=this.width)&&(!e[n].conditions.minHeight||!t||e[n].conditions.minHeight<=t)&&(!e[n].conditions.maxWidth||e[n].conditions.maxWidth>=this.width)&&(!e[n].conditions.maxHeight||!t||e[n].conditions.maxHeight>=t)&&(!e[n].conditions.custom||e[n].conditions.custom.call(this))){return e[n]}}};var appendComponents=function(e){var t;if(this.currentLayout.layout)t=this.currentLayout.layout[e];else t=this.currentLayout[e];if(t){this.regions[e].element.style.display="block";for(var n in t){if(!this.components[t[n]])this.components[t[n]]=new BasicPlayer.component[t[n]](this);this.components[t[n]].appendTo(this.regions[e].wrapper);this.components[t[n]]._detachFromPlayer=false}}else{this.regions[e].element.style.display="none"}};var manageComponents=function(){for(var e in this.components){this.components[e]._detachFromPlayer=true}appendComponents.call(this,"left");appendComponents.call(this,"right");appendComponents.call(this,"top");appendComponents.call(this,"bottom");for(var e in this.components){if(this.components[e]._detachFromPlayer&&this.components[e].element.parentNode)this.components[e].element.parentNode.removeChild(this.components[e].element)}};var BasicPlayer=WGo.extendClass(WGo.Player,function(e,t){this.config=t;for(var n in BasicPlayer.default)if(this.config[n]===undefined&&BasicPlayer.default[n]!==undefined)this.config[n]=BasicPlayer.default[n];for(var n in WGo.Player.default)if(this.config[n]===undefined&&WGo.Player.default[n]!==undefined)this.config[n]=WGo.Player.default[n];this.element=e;this.element.innerHTML="";this.classes=(this.element.className?this.element.className+" ":"")+"wgo-player-main";this.element.className=this.classes;if(!this.element.id)this.element.id="wgo_"+pl_count++;BPgenerateDom.call(this);this.board=new WGo.Board(this.dom.board,this.config.board);this.init();this.components={};window.addEventListener("resize",function(){if(!this.noresize){this.updateDimensions()}}.bind(this));this.updateDimensions();this.initGame()});BasicPlayer.prototype.appendTo=function(e){e.appendChild(this.element);this.updateDimensions()};BasicPlayer.prototype.updateDimensions=function(){var e=window.getComputedStyle(this.element);var t=[];while(this.element.firstChild){t.push(this.element.firstChild);this.element.removeChild(this.element.firstChild)}var n=parseInt(e.width);var r=parseInt(e.height);var i=parseInt(e.maxHeight)||0;for(var s=0;s<t.length;s++){this.element.appendChild(t[s])}if(n==this.width&&r==this.height&&i==this.maxHeight)return;this.width=n;this.height=r;this.maxHeight=i;this.currentLayout=getCurrentLayout.call(this);if(this.currentLayout&&this.lastLayout!=this.currentLayout){if(this.currentLayout.className)this.element.className=this.classes+" "+this.currentLayout.className;else this.element.className=this.classes;manageComponents.call(this);this.lastLayout=this.currentLayout}var o=this.dom.board.clientWidth;var u=this.height||this.maxHeight;if(u){u-=this.regions.top.element.offsetHeight+this.regions.bottom.element.offsetHeight}if(u&&u<o){if(u!=this.board.height)this.board.setHeight(u)}else{if(o!=this.board.width)this.board.setWidth(o)}var a=u-o;if(a>0){this.dom.board.style.height=u+"px";this.dom.board.style.paddingTop=a/2+"px"}else{this.dom.board.style.height="auto";this.dom.board.style.paddingTop="0"}this.regions.left.element.style.height=this.dom.center.offsetHeight+"px";this.regions.right.element.style.height=this.dom.center.offsetHeight+"px";for(var s in this.components){if(this.components[s].updateDimensions)this.components[s].updateDimensions()}};BasicPlayer.prototype.showMessage=function(e,t,n){this.info_overlay=document.createElement("div");this.info_overlay.style.width=this.element.offsetWidth+"px";this.info_overlay.style.height=this.element.offsetHeight+"px";this.info_overlay.className="wgo-info-overlay";this.element.appendChild(this.info_overlay);var r=document.createElement("div");r.className="wgo-info-message";r.innerHTML=e;var i=document.createElement("div");i.className="wgo-info-close";if(!n)i.innerHTML=WGo.t("BP:closemsg");r.appendChild(i);this.info_overlay.appendChild(r);if(t){this.info_overlay.addEventListener("click",function(e){t(e)})}else if(!n){this.info_overlay.addEventListener("click",function(e){this.hideMessage()}.bind(this))}this.setFrozen(true)};BasicPlayer.prototype.hideMessage=function(){this.element.removeChild(this.info_overlay);this.setFrozen(false)};BasicPlayer.prototype.error=function(e){if(!WGo.ERROR_REPORT)throw e;var t="#";switch(e.name){case"InvalidMoveError":this.showMessage("<h1>"+e.name+"</h1><p>"+e.message+"</p><p>If this message isn't correct, please report it by clicking <a href=\""+t+'">here</a>, otherwise contact maintainer of this site.</p>');break;case"FileError":this.showMessage("<h1>"+e.name+"</h1><p>"+e.message+"</p><p>Please contact maintainer of this site. Note: it is possible to read files only from this host.</p>");break;default:this.showMessage("<h1>"+e.name+"</h1><p>"+e.message+"</p><pre>"+e.stacktrace+'</pre><p>Please contact maintainer of this site. You can also report it <a href="'+t+'">here</a>.</p>')}};BasicPlayer.component={};BasicPlayer.layouts={one_column:{top:[],bottom:[]},no_comment:{top:[],bottom:[]},right_top:{top:[],right:[]},right:{right:[]},minimal:{bottom:[]}};BasicPlayer.dynamicLayout=[{conditions:{minWidth:650},layout:BasicPlayer.layouts["right_top"],className:"wgo-twocols wgo-large"},{conditions:{minWidth:550,minHeight:600},layout:BasicPlayer.layouts["one_column"],className:"wgo-medium"},{conditions:{minWidth:350},layout:BasicPlayer.layouts["no_comment"],className:"wgo-small"},{layout:BasicPlayer.layouts["no_comment"],className:"wgo-xsmall"}];BasicPlayer.default={layout:BasicPlayer.dynamicLayout};WGo.i18n.en["BP:closemsg"]="click anywhere to close this window";BasicPlayer.attributes={"data-wgo":function(e){if(e){if(e[0]=="(")this.sgf=e;else this.sgfFile=e}},"data-wgo-board":function(value){this.board=eval("({"+value+"})")},"data-wgo-onkifuload":function(e){this.kifuLoaded=new Function(e)},"data-wgo-onupdate":function(e){this.update=new Function(e)},"data-wgo-onfrozen":function(e){this.frozen=new Function(e)},"data-wgo-onunfrozen":function(e){this.unfrozen=new Function(e)},"data-wgo-layout":function(value){this.layout=eval("({"+value+"})")},"data-wgo-enablewheel":function(e){if(e.toLowerCase()=="false")this.enableWheel=false},"data-wgo-lockscroll":function(e){if(e.toLowerCase()=="false")this.lockScroll=false},"data-wgo-enablekeys":function(e){if(e.toLowerCase()=="false")this.enableKeys=false},"data-wgo-rememberpath":function(e){if(e.toLowerCase()=="false")this.rememberPath=false},"data-wgo-move":function(value){var m=parseInt(value);if(m)this.move=m;else this.move=eval("({"+value+"})")}};var player_from_tag=function(e){var t,n,r;n={};for(var i=0;i<e.attributes.length;i++){t=e.attributes[i];if(BasicPlayer.attributes[t.name])BasicPlayer.attributes[t.name].call(n,t.value,t.name)}r=new BasicPlayer(e,n);e._wgo_player=r};WGo.BasicPlayer=BasicPlayer;window.addEventListener("load",function(){var e=document.querySelectorAll("[data-wgo]");for(var t=0;t<e.length;t++){player_from_tag(e[t])}})})(WGo);(function(e,t){"use strict";var n=function(){this.element=document.createElement("div")};n.prototype={constructor:n,appendTo:function(e){e.appendChild(this.element)},getWidth:function(){var e=window.getComputedStyle(this.element);return parseInt(e.width)},getHeight:function(){var e=window.getComputedStyle(this.element);return parseInt(e.height)},updateDimensions:function(){}};e.BasicPlayer.component.Component=n})(WGo);(function(){"use strict";var e=function(){t.call(this,"white");t.call(this,"black");this.element.appendChild(this.white.box);this.element.appendChild(this.black.box)};var t=function(e){this[e]={};var t=this[e];t.box=document.createElement("div");t.box.className="wgo-box-wrapper wgo-player-wrapper wgo-"+e;t.name=document.createElement("div");t.name.className="wgo-box-title";t.name.innerHTML=e;t.box.appendChild(t.name);var r;r=document.createElement("div");r.className="wgo-player-info";t.box.appendChild(r);t.info={};t.info.rank=n("rank");t.info.rank.val.innerHTML="-";t.info.caps=n("caps");t.info.caps.val.innerHTML="0";t.info.time=n("time");t.info.time.val.innerHTML="--:--";r.appendChild(t.info.rank.wrapper);r.appendChild(t.info.caps.wrapper);r.appendChild(t.info.time.wrapper)};var n=function(e){var t={};t.wrapper=document.createElement("div");t.wrapper.className="wgo-player-info-box-wrapper";t.box=document.createElement("div");t.box.className="wgo-player-info-box";t.wrapper.appendChild(t.box);t.title=document.createElement("div");t.title.className="wgo-player-info-title";t.title.innerHTML=WGo.t(e);t.box.appendChild(t.title);t.val=document.createElement("div");t.val.className="wgo-player-info-value";t.box.appendChild(t.val);return t};var r=function(e){var t=e.kifu.info||{};if(t.black){this.black.name.innerHTML=WGo.filterHTML(t.black.name)||WGo.t("Black");this.black.info.rank.val.innerHTML=WGo.filterHTML(t.black.rank)||"-"}else{this.black.name.innerHTML=WGo.t("Black");this.black.info.rank.val.innerHTML="-"}if(t.white){this.white.name.innerHTML=WGo.filterHTML(t.white.name)||WGo.t("White");this.white.info.rank.val.innerHTML=WGo.filterHTML(t.white.rank)||"-"}else{this.white.name.innerHTML=WGo.t("White");this.white.info.rank.val.innerHTML="-"}this.black.info.caps.val.innerHTML="0";this.white.info.caps.val.innerHTML="0";if(t.TM){this.setPlayerTime("black",t.TM);this.setPlayerTime("white",t.TM)}else{this.black.info.time.val.innerHTML="--:--";this.white.info.time.val.innerHTML="--:--"}this.updateDimensions()};var i=function(e){var t,n,r;if(e.style.fontSize){var r=parseInt(e.style.fontSize);e.style.fontSize="";t=window.getComputedStyle(e);n=parseInt(t.fontSize);e.style.fontSize=r+"px"}else{t=window.getComputedStyle(e);n=r=parseInt(t.fontSize)}if(r==n&&e.scrollHeight<=e.offsetHeight)return;else if(e.scrollHeight>e.offsetHeight){r-=2;while(e.scrollHeight>e.offsetHeight&&r>1){e.style.fontSize=r+"px";r-=2}}else if(r<n){r+=2;while(e.scrollHeight<=e.offsetHeight&&r<=n){e.style.fontSize=r+"px";r+=2}if(e.scrollHeight>e.offsetHeight){e.style.fontSize=r-4+"px"}}};var s=function(e){if(e.node.BL)this.setPlayerTime("black",e.node.BL);if(e.node.WL)this.setPlayerTime("white",e.node.WL);if(e.position.capCount.black!==undefined)this.black.info.caps.val.innerHTML=e.position.capCount.black;if(e.position.capCount.white!==undefined)this.white.info.caps.val.innerHTML=e.position.capCount.white};var o=WGo.extendClass(WGo.BasicPlayer.component.Component,function(t){this.super(t);this.element.className="wgo-infobox";e.call(this);t.addEventListener("kifuLoaded",r.bind(this));t.addEventListener("update",s.bind(this))});o.prototype.setPlayerTime=function(e,t){var n=Math.floor(t/60);var r=Math.round(t)%60;this[e].info.time.val.innerHTML=n+":"+(r<10?"0"+r:r)};o.prototype.updateDimensions=function(){i(this.black.name);i(this.white.name)};var u=WGo.BasicPlayer.layouts;u["right_top"].right.push("InfoBox");u["right"].right.push("InfoBox");u["one_column"].top.push("InfoBox");u["no_comment"].top.push("InfoBox");WGo.i18n.en["rank"]="Rank";WGo.i18n.en["caps"]="Caps";WGo.i18n.en["time"]="Time";WGo.BasicPlayer.component.InfoBox=o})(WGo);(function(e,t){"use strict";var n=function(e,t){if(e.weight<t.weight)return-1;else if(e.weight>t.weight)return 1;else return 0};var r=function(e){this.iconBar=document.createElement("div");this.iconBar.className="wgo-control-wrapper";this.element.appendChild(this.iconBar);var t;for(var n in i.widgets){t=new i.widgets[n].constructor(e,i.widgets[n].args);t.appendTo(this.iconBar);this.widgets.push(t)}};var i=e.extendClass(e.BasicPlayer.component.Component,function(e){this.super(e);this.widgets=[];this.element.className="wgo-player-control";r.call(this,e)});i.prototype.updateDimensions=function(){if(this.element.clientWidth<340)this.element.className="wgo-player-control wgo-340";else if(this.element.clientWidth<440)this.element.className="wgo-player-control wgo-440";else this.element.className="wgo-player-control"};var s=e.BasicPlayer.control={};var o=function(e){if(!e.node.parent&&!this.disabled)this.disable();else if(e.node.parent&&this.disabled)this.enable()};var u=function(e){if(!e.node.children.length&&!this.disabled)this.disable();else if(e.node.children.length&&this.disabled)this.enable()};var a=function(e){this._disabled=this.disabled;if(!this.disabled)this.disable()};var f=function(e){if(!this._disabled)this.enable();delete this._disabled};s.Widget=function(e,t){this.element=this.element||document.createElement(t.type||"div");this.element.className="wgo-widget-"+t.name;this.init(e,t)};s.Widget.prototype={constructor:s.Widget,init:function(e,t){if(!t)return;if(t.disabled)this.disable();if(t.init)t.init.call(this,e)},appendTo:function(e){e.appendChild(this.element)},disable:function(){this.disabled=true;if(this.element.className.search("wgo-disabled")==-1){this.element.className+=" wgo-disabled"}},enable:function(){this.disabled=false;this.element.className=this.element.className.replace(" wgo-disabled","");this.element.disabled=""}};s.Group=e.extendClass(s.Widget,function(e,t){this.element=document.createElement("div");this.element.className="wgo-ctrlgroup wgo-ctrlgroup-"+t.name;var n;for(var r in t.widgets){n=new t.widgets[r].constructor(e,t.widgets[r].args);n.appendTo(this.element)}});s.Clickable=e.extendClass(s.Widget,function(e,t){this.super(e,t)});s.Clickable.prototype.init=function(e,t){var n,r=this;if(t.togglable){n=function(){if(r.disabled)return;if(t.click.call(r,e))r.select();else r.unselect()}}else{n=function(){if(r.disabled)return;t.click.call(r,e)}}this.element.addEventListener("click",n);this.element.addEventListener("touchstart",function(e){e.preventDefault();n();if(t.multiple){r._touch_i=0;r._touch_int=window.setInterval(function(){if(r._touch_i>500){n()}r._touch_i+=100},100)}return false});if(t.multiple){this.element.addEventListener("touchend",function(e){window.clearInterval(r._touch_int)})}if(t.disabled)this.disable();if(t.init)t.init.call(this,e)};s.Clickable.prototype.select=function(){this.selected=true;if(this.element.className.search("wgo-selected")==-1)this.element.className+=" wgo-selected"};s.Clickable.prototype.unselect=function(){this.selected=false;this.element.className=this.element.className.replace(" wgo-selected","")};s.Button=e.extendClass(s.Clickable,function(t,n){var r=this.element=document.createElement("button");r.className="wgo-button wgo-button-"+n.name;r.title=e.t(n.name);this.init(t,n)});s.Button.prototype.disable=function(){s.Button.prototype.super.prototype.disable.call(this);this.element.disabled="disabled"};s.Button.prototype.enable=function(){s.Button.prototype.super.prototype.enable.call(this);this.element.disabled=""};s.MenuItem=e.extendClass(s.Clickable,function(t,n){var r=this.element=document.createElement("div");r.className="wgo-menu-item wgo-menu-item-"+n.name;r.title=e.t(n.name);r.innerHTML=r.title;this.init(t,n)});s.MoveNumber=e.extendClass(s.Widget,function(e){this.element=document.createElement("form");this.element.className="wgo-player-mn-wrapper";var t=this.move=document.createElement("input");t.type="text";t.value="0";t.maxlength=3;t.className="wgo-player-mn-value";this.element.appendChild(t);this.element.onsubmit=t.onchange=function(e){e.goTo(this.getValue());return false}.bind(this,e);e.addEventListener("update",function(e){this.setValue(e.path.m)}.bind(this));e.addEventListener("kifuLoaded",this.enable.bind(this));e.addEventListener("frozen",this.disable.bind(this));e.addEventListener("unfrozen",this.enable.bind(this))});s.MoveNumber.prototype.disable=function(){s.MoveNumber.prototype.super.prototype.disable.call(this);this.move.disabled="disabled"};s.MoveNumber.prototype.enable=function(){s.MoveNumber.prototype.super.prototype.enable.call(this);this.move.disabled=""};s.MoveNumber.prototype.setValue=function(e){this.move.value=e};s.MoveNumber.prototype.getValue=function(){return parseInt(this.move.value)};var l=function(e){if(e._menu_tmp){delete e._menu_tmp;return}if(!e.menu){e.menu=document.createElement("div");e.menu.className="wgo-player-menu";e.menu.style.position="absolute";e.menu.style.display="none";e.element.appendChild(e.menu);var t;for(var n in i.menu){t=new i.menu[n].constructor(e,i.menu[n].args,true);t.appendTo(e.menu)}}if(e.menu.style.display!="none"){e.menu.style.display="none";document.removeEventListener("click",e._menu_ev);delete e._menu_ev;this.unselect();return false}else{e.menu.style.display="block";var r=0;var s=0;var o=this.element;while(o&&o.tagName!="BODY"){r+=o.offsetTop;s+=o.offsetLeft;o=o.offsetParent}if(this.element.parentElement.parentElement.parentElement.parentElement==e.regions.bottom.wrapper){e.menu.style.left=s+"px";e.menu.style.top=r-e.menu.offsetHeight+1+"px"}else{e.menu.style.left=s+"px";e.menu.style.top=r+this.element.offsetHeight+"px"}e._menu_ev=l.bind(this,e);e._menu_tmp=true;document.addEventListener("click",e._menu_ev);return true}};i.menu=[{constructor:s.MenuItem,args:{name:"switch-coo",togglable:true,click:function(e){e.setCoordinates(!e.coordinates);return e.coordinates},init:function(e){if(e.coordinates)this.select()}}}];i.widgets=[{constructor:s.Group,args:{name:"left",widgets:[{constructor:s.Button,args:{name:"menu",togglable:true,click:l}}]}},{constructor:s.Group,args:{name:"right",widgets:[{constructor:s.Button,args:{name:"about",click:function(t){t.showMessage(e.t("about-text"))}}}]}},{constructor:s.Group,args:{name:"control",widgets:[{constructor:s.Button,args:{name:"first",disabled:true,init:function(e){e.addEventListener("update",o.bind(this));e.addEventListener("frozen",a.bind(this));e.addEventListener("unfrozen",f.bind(this))},click:function(e){e.first()}}},{constructor:s.Button,args:{name:"multiprev",disabled:true,multiple:true,init:function(e){e.addEventListener("update",o.bind(this));e.addEventListener("frozen",a.bind(this));e.addEventListener("unfrozen",f.bind(this))},click:function(t){var n=e.clone(t.kifuReader.path);n.m-=10;t.goTo(n)}}},{constructor:s.Button,args:{name:"previous",disabled:true,multiple:true,init:function(e){e.addEventListener("update",o.bind(this));e.addEventListener("frozen",a.bind(this));e.addEventListener("unfrozen",f.bind(this))},click:function(e){e.previous()}}},{constructor:s.MoveNumber},{constructor:s.Button,args:{name:"next",disabled:true,multiple:true,init:function(e){e.addEventListener("update",u.bind(this));e.addEventListener("frozen",a.bind(this));e.addEventListener("unfrozen",f.bind(this))},click:function(e){e.next()}}},{constructor:s.Button,args:{name:"multinext",disabled:true,multiple:true,init:function(e){e.addEventListener("update",u.bind(this));e.addEventListener("frozen",a.bind(this));e.addEventListener("unfrozen",f.bind(this))},click:function(t){var n=e.clone(t.kifuReader.path);n.m+=10;t.goTo(n)}}},{constructor:s.Button,args:{name:"last",disabled:true,init:function(e){e.addEventListener("update",u.bind(this));e.addEventListener("frozen",a.bind(this));e.addEventListener("unfrozen",f.bind(this))},click:function(e){e.last()}}}]}}];var c=e.BasicPlayer.layouts;c["right_top"].top.push("Control");c["right"].right.push("Control");c["one_column"].top.push("Control");c["no_comment"].bottom.push("Control");c["minimal"].bottom.push("Control");var h={about:"About",first:"First",multiprev:"10 moves back",previous:"Previous",next:"Next",multinext:"10 moves forward",last:"Last","switch-coo":"Display coordinates",menu:"Menu"};for(var p in h)e.i18n.en[p]=h[p];e.BasicPlayer.component.Control=i})(WGo);(function(e,t){"use strict";var n=function(){this.box=document.createElement("div");this.box.className="wgo-box-wrapper wgo-comments-wrapper";this.element.appendChild(this.box);this.comments_title=document.createElement("div");this.comments_title.className="wgo-box-title";this.comments_title.innerHTML=e.t("comments");this.box.appendChild(this.comments_title);this.comments=document.createElement("div");this.comments.className="wgo-comments-content";this.box.appendChild(this.comments);this.help=document.createElement("div");this.help.className="wgo-help";this.help.style.display="none";this.comments.appendChild(this.help);this.notification=document.createElement("div");this.notification.className="wgo-notification";this.notification.style.display="none";this.comments.appendChild(this.notification);this.comment_text=document.createElement("div");this.comment_text.className="wgo-comment-text";this.comments.appendChild(this.comment_text)};var r=function(e){var t,n;t=e.charCodeAt(0)-"a".charCodeAt(0);if(t<0)t+="a".charCodeAt(0)-"A".charCodeAt(0);if(t>7)t--;n=e.charCodeAt(1)-"0".charCodeAt(0);if(e.length>2)n=n*10+(e.charCodeAt(2)-"0".charCodeAt(0));n=this.kifuReader.game.size-n;this._tmp_mark={type:"MA",x:t,y:n};this.board.addObject(this._tmp_mark)};var i=function(){this.board.removeObject(this._tmp_mark);delete this._tmp_mark};var s=function(e,t){for(var n in e){if(e[n].className&&e[n].className=="wgo-move-link"){e[n].addEventListener("mouseover",r.bind(t,e[n].innerHTML));e[n].addEventListener("mouseout",i.bind(t))}else if(e[n].childNodes&&e[n].childNodes.length)s(e[n].childNodes,t)}};var o=function(t,n){var r='<div class="wgo-info-list">';if(n)r+='<div class="wgo-info-title">'+e.t("gameinfo")+"</div>";for(var i in t){r+='<div class="wgo-info-item"><span class="wgo-info-label">'+i+'</span><span class="wgo-info-value">'+t[i]+"</span></div>"}r+="</div>";return r};var u=e.extendClass(e.BasicPlayer.component.Component,function(t){this.super(t);this.player=t;this.element.className="wgo-commentbox";n.call(this);t.addEventListener("kifuLoaded",function(n){if(n.kifu.hasComments()){this.comments_title.innerHTML=e.t("comments");this.element.className="wgo-commentbox";this._update=function(e){this.setComments(e)}.bind(this);t.addEventListener("update",this._update)}else{this.comments_title.innerHTML=e.t("gameinfo");this.element.className="wgo-commentbox wgo-gameinfo";if(this._update){t.removeEventListener("update",this._update);delete this._update}this.comment_text.innerHTML=o(n.target.getGameInfo())}}.bind(this));t.notification=function(e){if(e){this.notification.style.display="block";this.notification.innerHTML=e;this.is_notification=true}else{this.notification.style.display="none";this.is_notification=false}if(this.is_notification||this.is_help)this.comment_text.style.display="none";else this.comment_text.style.display="block"}.bind(this);t.help=function(e){if(e){this.help.style.display="block";this.help.innerHTML=e;this.is_help=true}else{this.help.style.display="none";this.is_help=false}if(this.is_notification||this.is_help)this.comment_text.style.display="none";else this.comment_text.style.display="block"}.bind(this)});u.prototype.setComments=function(e){if(this.player._tmp_mark)i.call(this.player);var t="";if(!e.node.parent){t=o(e.target.getGameInfo(),true)}this.comment_text.innerHTML=t+this.getCommentText(e.node.comment,this.player.config.formatNicks,this.player.config.formatMoves);if(this.player.config.formatMoves){if(this.comment_text.childNodes&&this.comment_text.childNodes.length)s(this.comment_text.childNodes,this.player)}};u.prototype.getCommentText=function(t,n,r){if(t){var i="<p>"+e.filterHTML(t).replace(/\n/g,"</p><p>")+"</p>";if(n)i=i.replace(/(<p>)([^:]{3,}:)\s/g,'<p><span class="wgo-comments-nick">$2</span> ');if(r)i=i.replace(/\b[a-zA-Z]1?\d\b/g,'<a href="javascript:void(0)" class="wgo-move-link">$&</a>');return i}return""};e.BasicPlayer.default.formatNicks=true;e.BasicPlayer.default.formatMoves=true;e.BasicPlayer.attributes["data-wgo-formatnicks"]=function(e){if(e.toLowerCase()=="false")this.formatNicks=false};e.BasicPlayer.attributes["data-wgo-formatmoves"]=function(e){if(e.toLowerCase()=="false")this.formatMoves=false};e.BasicPlayer.layouts["right_top"].right.push("CommentBox");e.BasicPlayer.layouts["right"].right.push("CommentBox");e.BasicPlayer.layouts["one_column"].bottom.push("CommentBox");e.i18n.en["comments"]="Comments";e.i18n.en["gameinfo"]="Game info";e.BasicPlayer.component.CommentBox=u})(WGo);(function(e){var t=function(e,t){if(this.player.frozen||this._lastX==e&&this._lastY==t)return;this._lastX=e;this._lastY=t;if(this._last_mark){this.board.removeObject(this._last_mark)}if(e!=-1&&t!=-1&&this.player.kifuReader.game.isValid(e,t)){this._last_mark={type:"outline",x:e,y:t,c:this.player.kifuReader.game.turn};this.board.addObject(this._last_mark)}else{delete this._last_mark}};var n=function(){if(this._last_mark){this.board.removeObject(this._last_mark);delete this._last_mark;delete this._lastX;delete this._lastY}};var r=function(e,t){var n=e.size,r=[],i=[];for(var s=0;s<n*n;s++){if(e.schema[s]&&!t.schema[s])i.push({x:Math.floor(s/n),y:s%n});else if(e.schema[s]!=t.schema[s])r.push({x:Math.floor(s/n),y:s%n,c:t.schema[s]})}return{add:r,remove:i}};e.Player.Editable={};e.Player.Editable=function(e,t){this.player=e;this.board=t;this.editMode=false};e.Player.Editable.prototype.set=function(i){if(!this.editMode&&i){this.originalReader=this.player.kifuReader;this.player.kifuReader=new e.KifuReader(this.player.kifu.clone(),this.originalReader.rememberPath);this.player.kifuReader.goTo(this.originalReader.path);this._ev_click=this._ev_click||this.play.bind(this);this._ev_move=this._ev_move||t.bind(this);this._ev_out=this._ev_out||n.bind(this);this.board.addEventListener("click",this._ev_click);this.board.addEventListener("mousemove",this._ev_move);this.board.addEventListener("mouseout",this._ev_out);this.editMode=true}else if(this.editMode&&!i){this.originalReader.goTo(this.player.kifuReader.path);this.originalReader.change=r(this.player.kifuReader.getPosition(),this.originalReader.getPosition());this.player.kifuReader=this.originalReader;this.player.update(true);this.board.removeEventListener("click",this._ev_click);this.board.removeEventListener("mousemove",this._ev_move);this.board.removeEventListener("mouseout",this._ev_out);this.editMode=false}};e.Player.Editable.prototype.play=function(t,n){if(this.player.frozen||!this.player.kifuReader.game.isValid(t,n))return;this.player.kifuReader.node.appendChild(new e.KNode({move:{x:t,y:n,c:this.player.kifuReader.game.turn},edited:true}));this.player.next(this.player.kifuReader.node.children.length-1)};if(e.BasicPlayer&&e.BasicPlayer.component.Control){e.BasicPlayer.component.Control.menu.push({constructor:e.BasicPlayer.control.MenuItem,args:{name:"editmode",togglable:true,click:function(t){this._editable=this._editable||new e.Player.Editable(t,t.board);this._editable.set(!this._editable.editMode);return this._editable.editMode},init:function(e){var t=this;e.addEventListener("frozen",function(e){t._disabled=t.disabled;if(!t.disabled)t.disable()});e.addEventListener("unfrozen",function(e){if(!t._disabled)t.enable();delete t._disabled})}}})}e.i18n.en["editmode"]="Edit mode"})(WGo);(function(e){var n=function(e,t,n,r){this.originalPosition=e;this.position=e.clone();this.board=t;this.komi=n;this.output=r};var r=n.state={UNKNOWN:0,BLACK_STONE:1,WHITE_STONE:-1,BLACK_CANDIDATE:2,WHITE_CANDIDATE:-2,BLACK_NEUTRAL:3,WHITE_NEUTRAL:-3,NEUTRAL:4};var i=function(e,t,n,r,s){var o=e.get(t,n);if(o===undefined||o==r||o==s)return;e.set(t,n,r);i(e,t-1,n,r,s);i(e,t,n-1,r,s);i(e,t+1,n,r,s);i(e,t,n+1,r,s)};var o=function(e,t,n,r,i){var s=t.get(n,r);if(e.get(n,r)==s)return;e.set(n,r,s);o(e,t,n-1,r,i);o(e,t,n,r-1,i);o(e,t,n+1,r,i);o(e,t,n,r+1,i)};n.prototype.start=function(){this.calculate();this.saved_state=this.board.getState();this.displayScore();this._click=function(t,n){var s=this.originalPosition.get(t,n);if(s==e.W){if(this.position.get(t,n)==r.WHITE_STONE)i(this.position,t,n,r.BLACK_CANDIDATE,r.BLACK_STONE);else{o(this.position,this.originalPosition,t,n,r.BLACK_STONE);this.calculate()}}else if(s==e.B){if(this.position.get(t,n)==r.BLACK_STONE)i(this.position,t,n,r.WHITE_CANDIDATE,r.WHITE_STONE);else{o(this.position,this.originalPosition,t,n,r.WHITE_STONE);this.calculate()}}else{var u=this.position.get(t,n);if(u==r.BLACK_CANDIDATE)this.position.set(t,n,r.BLACK_NEUTRAL);else if(u==r.WHITE_CANDIDATE)this.position.set(t,n,r.WHITE_NEUTRAL);else if(u==r.BLACK_NEUTRAL)this.position.set(t,n,r.BLACK_CANDIDATE);else if(u==r.WHITE_NEUTRAL)this.position.set(t,n,r.WHITE_CANDIDATE)}this.board.restoreState({objects:e.clone(this.saved_state.objects)});this.displayScore()}.bind(this);this.board.addEventListener("click",this._click)};n.prototype.end=function(){this.board.restoreState({objects:e.clone(this.saved_state.objects)});this.board.removeEventListener("click",this._click)};n.prototype.displayScore=function(){var n={black:[],white:[],neutral:[],black_captured:[],white_captured:[]};for(var i=0;i<this.position.size;i++){for(var o=0;o<this.position.size;o++){s=this.position.get(i,o);t=this.originalPosition.get(i,o);if(s==r.BLACK_CANDIDATE)n.black.push({x:i,y:o,type:"mini",c:e.B});else if(s==r.WHITE_CANDIDATE)n.white.push({x:i,y:o,type:"mini",c:e.W});else if(s==r.NEUTRAL)n.neutral.push({x:i,y:o});if(t==e.W&&s!=r.WHITE_STONE)n.white_captured.push({x:i,y:o,type:"outline",c:e.W});else if(t==e.B&&s!=r.BLACK_STONE)n.black_captured.push({x:i,y:o,type:"outline",c:e.B})}}for(var i=0;i<n.black_captured.length;i++){this.board.removeObjectsAt(n.black_captured[i].x,n.black_captured[i].y)}for(var i=0;i<n.white_captured.length;i++){this.board.removeObjectsAt(n.white_captured[i].x,n.white_captured[i].y)}this.board.addObject(n.white_captured);this.board.addObject(n.black_captured);this.board.addObject(n.black);this.board.addObject(n.white);var u="<p style='font-weight: bold;'>"+e.t("RE")+"</p>";var a=n.black.length+n.white_captured.length+this.originalPosition.capCount.black;var f=n.white.length+n.black_captured.length+this.originalPosition.capCount.white+parseFloat(this.komi);u+="<p>"+e.t("black")+": "+n.black.length+" + "+(n.white_captured.length+this.originalPosition.capCount.black)+" = "+a+"</br>";u+=e.t("white")+": "+n.white.length+" + "+(n.black_captured.length+this.originalPosition.capCount.white)+" + "+this.komi+" = "+f+"</p>";if(a>f)u+="<p style='font-weight: bold;'>"+e.t("bwin",a-f)+"</p>";else u+="<p style='font-weight: bold;'>"+e.t("wwin",f-a)+"</p>";this.output(u)};n.prototype.calculate=function(){var e,t,n,i,s,o;e=this.position;o=true;while(o){o=false;for(var u=0;u<e.size;u++){for(var a=0;a<e.size;a++){t=e.get(a,u);if(t==r.UNKNOWN||t==r.BLACK_CANDIDATE||t==r.WHITE_CANDIDATE){n=[e.get(a-1,u),e.get(a,u-1),e.get(a+1,u),e.get(a,u+1)];i=false;s=false;for(var f=0;f<4;f++){if(n[f]==r.BLACK_STONE||n[f]==r.BLACK_CANDIDATE)i=true;else if(n[f]==r.WHITE_STONE||n[f]==r.WHITE_CANDIDATE)s=true;else if(n[f]==r.NEUTRAL){i=true;s=true}}n=false;if(i&&s)n=r.NEUTRAL;else if(i)n=r.BLACK_CANDIDATE;else if(s)n=r.WHITE_CANDIDATE;if(n&&t!=n){o=true;e.set(a,u,n)}}}}}};e.ScoreMode=n;if(e.BasicPlayer&&e.BasicPlayer.component.Control){e.BasicPlayer.component.Control.menu.push({constructor:e.BasicPlayer.control.MenuItem,args:{name:"scoremode",togglable:true,click:function(t){if(this.selected){t.setFrozen(false);this._score_mode.end();delete this._score_mode;t.notification();t.help();return false}else{t.setFrozen(true);t.help("<p>"+e.t("help_score")+"</p>");this._score_mode=new e.ScoreMode(t.kifuReader.game.position,t.board,t.kifu.info.KM||.5,t.notification);this._score_mode.start();return true}}}})}e.i18n.en["scoremode"]="Count score";e.i18n.en["score"]="Score";e.i18n.en["bwin"]="Black wins by $ points.";e.i18n.en["wwin"]="White wins by $ points.";e.i18n.en["help_score"]="Click on stones to mark them dead or alive. You can also set and unset territory points by clicking on them. Territories must be completely bordered."})(WGo);(function(e,t){"use strict";var n={active:true,query:{}};var r=function(e){try{n.query=JSON.parse('{"'+window.location.hash.substr(1).replace("=",'":')+"}")}catch(t){n.query={}}};window.addEventListener("hashchange",function(){if(window.location.hash!=""&&n.active){r();for(var e in n.query){var t=document.getElementById(e);if(t&&t._wgo_player)t._wgo_player.goTo(i)}}});window.addEventListener("DOMContentLoaded",function(){if(window.location.hash!=""&&n.active){r()}});window.addEventListener("load",function(){if(window.location.hash!=""&&n.active){for(var e in n.query){var t=document.getElementById(e);if(t&&t._wgo_player){t.scrollIntoView();break}}}});var i=function(){if(n.query[this.element.id]){return n.query[this.element.id].goto}};e.Player.default.move=i;if(e.BasicPlayer&&e.BasicPlayer.component.Control){e.BasicPlayer.component.Control.menu.push({constructor:e.BasicPlayer.control.MenuItem,args:{name:"permalink",click:function(t){var n=location.href.split("#")[0]+"#"+t.element.id+'={"goto":'+JSON.stringify(t.kifuReader.path)+"}";t.showMessage("<h1>"+e.t("permalink")+'</h1><p><input class="wgo-permalink" type="text" value=\''+n+'\' onclick="this.select(); event.stopPropagation()"/></p>')}}})}e.Player.permalink=n;e.i18n.en["permalink"]="Permanent link"})(WGo)